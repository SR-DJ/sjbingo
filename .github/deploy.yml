# .github/workflows/deploy.yml

name: Build and Deploy to GitHub Pages

# è§¦å‘æ¡ä»¶ï¼šå½“ä»£ç è¢«æ¨é€åˆ° main åˆ†æ”¯æ—¶è§¦å‘
on:
  push:
    branches:
      - main # æˆ–è€…ä½ çš„ä¸»åˆ†æ”¯åï¼Œå¦‚ master

# ä»»åŠ¡
jobs:
  build-and-deploy:
    # è¿è¡Œç¯å¢ƒï¼šä½¿ç”¨æœ€æ–°çš„ Ubuntu
    runs-on: ubuntu-latest

    # æ­¥éª¤
    steps:
      # æ­¥éª¤1: æ£€å‡ºä»£ç 
      # è¿™ä¸ª Action ä¼šæŠŠä½ çš„ä»“åº“ä»£ç ä¸‹è½½åˆ°è¿è¡Œå™¨ä¸­
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v3

      # æ­¥éª¤2: è®¾ç½® Node.js ç¯å¢ƒ
      # æŒ‡å®š Node.js ç‰ˆæœ¬ï¼Œå¹¶è®¾ç½®ç¼“å­˜ä»¥åŠ å¿«åç»­æ„å»ºé€Ÿåº¦
      - name: Setup Node.js âš™ï¸
        uses: actions/setup-node@v3
        with:
          node-version: '18' # æ¨èä½¿ç”¨ LTS ç‰ˆæœ¬
          cache: 'npm'

      # æ­¥éª¤3: å®‰è£…é¡¹ç›®ä¾èµ–
      # è¿è¡Œ npm ci ä¼šæ ¹æ® package-lock.json ç²¾ç¡®å®‰è£…ä¾èµ–ï¼Œæ¯” npm install æ›´å¿«æ›´å¯é 
      - name: Install dependencies ğŸ“¦
        run: npm ci

      # æ­¥éª¤4: æ„å»ºå’Œæ··æ·†ä»£ç 
      # è¿è¡Œä½ åœ¨ package.json ä¸­å®šä¹‰çš„ build è„šæœ¬
      - name: Build and Obfuscate ğŸ—ï¸
        run: npm run build

      # æ­¥éª¤5: éƒ¨ç½²åˆ° gh-pages åˆ†æ”¯
      # ä½¿ç”¨ä¸€ä¸ªæµè¡Œçš„ Action æ¥å¤„ç†éƒ¨ç½²çš„å¤æ‚æ€§
      - name: Deploy to GitHub Pages ğŸš€
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist # æŒ‡å®šè¦å‘å¸ƒçš„æ˜¯ dist ç›®å½•
          # å¯é€‰ï¼šå¦‚æœä½ æƒ³ä½¿ç”¨è‡ªå®šä¹‰åŸŸå
          # cname: your.custom.domain.com
